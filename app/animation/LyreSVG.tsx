import { useEffect, useRef } from 'react';
import { NUM_POINTS, IMAGE_PADDING_Y, SVGPoint, LYRE_VIEW_X, LYRE_VIEW_Y } from './page';

const LyreSVG = ({ lyreRef, setPoints }: { lyreRef: React.RefObject<HTMLDivElement | null>; setPoints: React.Dispatch<React.SetStateAction<SVGPoint[]>> }) => {
    const pathRef = useRef<SVGPathElement>(null);

    useEffect(() => {
        const path = pathRef.current;
        if (!path) return;

        const totalLength = path.getTotalLength();

        const extracted: SVGPoint[] = [];
        for (let i = 0; i < NUM_POINTS; i++) {
            const distance = (i / NUM_POINTS) * totalLength;
            const { x, y } = path.getPointAtLength(distance);
            extracted.push({ x, y });
        }

        setPoints([...extracted]);
    }, []);

    return (
        <div ref={lyreRef} className='absolute left-[50%] top-[50%] transform-[translate(-50%,-50%)]'>
            <svg
                version='1.1'
                id='Layer_1'
                xmlns='http://www.w3.org/2000/svg'
                xmlnsXlink='http://www.w3.org/1999/xlink'
                x='0px'
                y='0px'
                width='100%'
                viewBox='0 0 688 688'
                enableBackground='new 0 0 688 688'
                xmlSpace='preserve'
                className='w-fit max-w-dvw opacity-0'
                style={{
                    height: `calc(100dvh - ${IMAGE_PADDING_Y * 2}px)`,
                    maxHeight: `${lyreRef && lyreRef.current ? lyreRef.current.clientWidth * (LYRE_VIEW_Y / LYRE_VIEW_X) : '100%'}`,
                }}
            >
                <path
                    fill='#ffffff'
                    opacity='1.000000'
                    stroke='none'
                    ref={pathRef}
                    d='
                        M290.999939,604.919189 
                            C271.512146,604.750671 252.487213,606.080566 233.544479,604.408752 
                            C216.992081,602.947876 209.035721,591.637512 212.063751,575.116089 
                            C214.258652,563.140442 218.840164,552.166443 225.800980,542.175598 
                            C229.337433,537.099731 229.353989,537.000671 223.920807,534.279724 
                            C197.386597,520.991272 175.801987,502.107513 159.871094,477.039978 
                            C144.125443,452.263855 139.638275,424.917053 142.290634,396.072784 
                            C145.953491,356.239655 161.673172,320.616608 180.321091,285.928040 
                            C190.489807,267.012360 200.927658,248.200882 209.138428,228.299973 
                            C216.164993,211.269196 221.663879,193.920715 220.786270,175.100830 
                            C219.801407,153.981308 205.057083,135.642578 185.020782,130.924408 
                            C166.609131,126.588791 146.150665,141.385147 145.727463,158.318222 
                            C145.368423,172.684586 153.509567,183.044952 167.109253,182.985687 
                            C170.938675,182.968994 174.771103,182.760086 178.594849,182.521942 
                            C185.048508,182.120056 189.437042,185.058975 192.152390,190.742050 
                            C194.922943,196.540710 194.356232,202.095901 190.510757,207.190475 
                            C184.728500,214.850967 176.501480,217.043030 167.469376,216.700241 
                            C156.934738,216.300430 147.254837,212.794785 138.198776,207.538986 
                            C117.159569,195.328674 110.060753,172.197205 114.290192,150.136932 
                            C119.969917,120.512184 143.235703,99.197044 173.297318,97.225914 
                            C196.575760,95.699547 216.310822,104.741882 231.682129,122.470406 
                            C247.754120,141.007095 254.690659,162.689484 252.958313,187.111816 
                            C252.670471,191.169876 254.441055,192.605972 258.105194,192.599380 
                            C262.937836,192.590698 267.771088,192.610840 272.602936,192.539719 
                            C276.822052,192.477615 279.065460,191.084656 278.148041,186.080536 
                            C277.204041,180.931152 278.200195,175.710510 280.790039,171.097916 
                            C283.994965,165.389847 289.095520,162.438522 295.681183,162.927673 
                            C302.379364,163.425186 307.446686,166.579681 309.421814,173.374557 
                            C310.722595,177.849594 311.777161,182.465088 310.785004,187.135406 
                            C309.983704,190.907501 311.401611,192.557465 315.040161,192.589844 
                            C319.705658,192.631348 324.371979,192.592377 329.037842,192.567566 
                            C332.584351,192.548706 334.323578,190.945496 333.670837,187.240494 
                            C333.002045,183.444214 332.838806,179.674118 333.748749,175.854980 
                            C335.623596,167.985672 341.297699,163.262939 349.412750,163.019257 
                            C357.226410,162.784607 362.973083,167.103470 365.291351,174.836182 
                            C366.562225,179.075211 366.508087,183.408478 366.273773,187.727219 
                            C366.073975,191.410629 367.547760,193.044022 371.220978,192.665680 
                            C371.385773,192.648697 371.554779,192.676620 371.720551,192.665024 
                            C376.514954,192.330154 382.159607,194.362289 385.908783,191.598404 
                            C390.124084,188.490845 387.205811,182.587311 387.604218,177.943207 
                            C388.343140,169.329590 393.533661,163.787918 402.218994,163.094040 
                            C411.012939,162.391495 417.393188,166.866379 419.394958,174.969330 
                            C420.369812,178.915390 420.540985,182.907089 420.184082,186.883011 
                            C419.807983,191.072586 421.482666,192.674744 425.587097,192.481079 
                            C431.074982,192.222183 436.583435,191.974350 442.066742,192.172684 
                            C446.660950,192.338852 448.248718,190.688293 447.951508,186.048996 
                            C447.021545,171.532104 449.238373,157.395294 455.181702,144.120987 
                            C466.891602,117.967026 486.094574,101.154381 515.346008,97.529999 
                            C548.754883,93.390495 580.221375,116.293518 587.364990,149.506210 
                            C595.770935,188.587769 566.551331,214.589706 536.863892,216.764740 
                            C529.313354,217.317932 521.883118,215.838867 515.526794,211.175018 
                            C509.119934,206.474182 506.734741,199.481476 509.124054,192.777542 
                            C511.666656,185.643448 516.555603,182.685898 525.135376,182.713470 
                            C529.467834,182.727402 533.723328,184.136765 538.069885,183.371353 
                            C551.080933,181.080078 558.687988,168.438843 555.198853,154.963821 
                            C550.871582,138.251678 532.452515,127.144936 515.621033,131.098190 
                            C495.969116,135.713867 483.209381,150.378433 481.178772,170.293808 
                            C478.500946,196.557297 486.832336,220.290176 498.222168,243.139099 
                            C508.548431,263.854431 520.054932,283.981140 530.395935,304.689484 
                            C544.863098,333.660461 554.641052,364.293518 557.960266,396.522125 
                            C561.985413,435.605347 550.186279,469.840210 523.235229,498.671539 
                            C509.549286,513.312256 493.916718,525.345154 475.722565,533.839783 
                            C471.447754,535.835632 470.942474,537.496826 473.623688,541.586060 
                            C482.160492,554.605713 487.777618,568.693665 487.348175,584.667297 
                            C487.019379,596.896484 481.991455,602.809448 469.925201,604.327332 
                            C456.315521,606.039429 442.630188,604.935669 428.983124,604.966064 
                            C383.155670,605.068115 337.327728,604.950867 290.999939,604.919189 
                        M422.283813,246.500031 
                            C422.274078,263.326385 422.268066,280.152740 422.253998,296.979095 
                            C422.194702,367.949432 422.131409,438.919739 422.074585,509.890076 
                            C422.069122,516.725037 422.142517,516.828064 428.702026,515.634766 
                            C456.838928,510.516144 480.845734,497.769592 499.982666,476.393219 
                            C521.538025,452.315369 529.734131,424.068085 524.892395,392.216370 
                            C519.715332,358.158966 505.598389,327.311310 490.107025,296.948669 
                            C478.241791,273.693146 462.535065,252.428024 454.074860,227.412491 
                            C453.093079,224.509598 451.058533,223.296890 447.972900,223.339142 
                            C440.977264,223.434921 433.977631,223.440918 426.982880,223.308807 
                            C423.593658,223.244812 422.150421,224.531662 422.246857,228.008698 
                            C422.408386,233.835037 422.286530,239.669250 422.283813,246.500031 
                        M174.255112,415.389709 
                            C174.581223,430.728027 178.880203,445.049347 186.642593,458.095703 
                            C205.648315,490.038879 234.027344,508.726471 270.294739,515.844788 
                            C277.828217,517.323425 277.893036,517.318848 277.892395,509.692261 
                            C277.887848,456.204132 277.881348,402.716034 277.881073,349.227905 
                            C277.880859,309.570038 277.826508,269.911926 277.975800,230.254608 
                            C277.993652,225.511520 276.512390,223.638779 271.693695,223.835678 
                            C265.541870,224.087067 259.346405,224.112198 253.212555,223.657318 
                            C249.303284,223.367432 247.455215,224.762756 246.165359,228.269058 
                            C242.193283,239.066635 237.322723,249.423920 231.520233,259.413452 
                            C215.539490,286.925720 199.782440,314.591736 188.585480,344.510406 
                            C180.155457,367.035675 172.925964,389.866333 174.255112,415.389709 
                        M309.352692,380.499939 
                            C309.351288,418.665039 309.349823,456.830109 309.348480,494.995209 
                            C309.348297,500.661621 309.480408,506.332245 309.300781,511.992950 
                            C309.186890,515.581604 310.405060,517.226990 314.182251,517.030090 
                            C318.170624,516.822144 322.179291,517.014709 326.179108,517.012573 
                            C333.673340,517.008545 333.683899,517.002625 333.684204,509.671448 
                            C333.688110,417.675171 333.688812,325.678925 333.689514,233.682648 
                            C333.689514,231.849396 333.535339,230.002823 333.703644,228.185669 
                            C334.055817,224.383865 332.249359,223.171509 328.686371,223.326950 
                            C324.694550,223.501083 320.688599,223.344498 316.688812,223.344345 
                            C309.403259,223.344086 309.373138,223.349518 309.371277,230.505981 
                            C309.358185,280.170624 309.357910,329.835266 309.352692,380.499939 
                        M366.789795,515.646240 
                            C370.929352,518.285645 375.525879,516.810181 379.889313,516.921143 
                            C390.584625,517.193237 390.634644,517.028748 390.596680,506.368500 
                            C390.375244,444.210022 390.962097,382.051178 390.202789,319.891693 
                            C389.877258,293.237396 390.441711,266.572327 390.596100,239.912125 
                            C390.615417,236.579071 390.513611,233.243057 390.621033,229.913345 
                            C390.766937,225.389725 389.030243,223.020126 384.156525,223.324921 
                            C380.504761,223.553284 376.826447,223.346710 373.160004,223.352264 
                            C366.326233,223.362595 366.326385,223.368195 366.326691,230.355026 
                            C366.329956,313.350952 366.327606,396.346863 366.342621,479.342804 
                            C366.344757,491.173309 366.431122,503.003784 366.789795,515.646240 
                        M374.499908,573.604675 
                            C398.490417,573.596313 422.480957,573.588867 446.471466,573.577026 
                            C447.803955,573.576355 449.140839,573.600952 450.467896,573.505554 
                            C452.574432,573.353882 454.447968,572.605347 455.299530,570.530640 
                            C456.163910,568.424561 454.631317,567.095032 453.331696,565.808716 
                            C449.543060,562.058777 445.580963,558.473022 441.953766,554.574524 
                            C438.874725,551.265198 435.365021,550.159424 430.867615,550.170410 
                            C380.887756,550.292847 330.899170,550.737976 280.932922,549.902588 
                            C267.938568,549.685303 258.033203,552.732300 250.158279,562.766479 
                            C248.204178,565.256348 243.967194,566.894775 245.641510,570.859680 
                            C247.248718,574.665649 251.355804,573.568054 254.547150,573.572693 
                            C294.197998,573.629883 333.848938,573.606323 374.499908,573.604675 
                        z'
                />
            </svg>
        </div>
    );
};

export default LyreSVG;
